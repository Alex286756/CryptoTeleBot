# Телеграмм-бот (криптография и стеганография)

[![cov](https://Alex286756.github.io/CryptoTeleBot/badges/coverage.svg)](https://github.com/Alex286756/CryptoTeleBot/actions)

Функционал проекта:  
Телеграмм-бот является логичным продолжением и развитием desktop-приложения "Шифрование".  
В ходе общения с ботом и ответа на несколько вопросов пользователь получит зашифрованное сообщение, которое может 
направить любым доступным способом своим друзьям, или наоборот, полученное от друзей сообщение расшифровать с 
помощью данного бота.  

Бот может работать со следующими алгоритмами шифрования:  
- Шифр Цезаря (как шифрования/расшифрования так и взлом);  
- Шифр Виженера;  
- Шифр Вернама;  
- стеганография BMP-, JPG- и PNG-изображений.  

1. Модуль работы с шифром Цезаря.  
Шифр Цезаря - шифр, при использовании которого каждая буква из открытого текста заменяется на такую букву, которая в 
алфавите находится на некотором постоянном числе позиций левее или правее от рассматриваемой буквы.

Шифр Цезаря легко взламывается, от чего почти не применяется на практике, но тем не менее известен как один из самых 
простых методов шифрования.

Математически шифр Цезаря описывается как:  
с = (p + k) mod n, где:  
p — номер (буквы нумеруются с 0) в алфавите той буквы, которая была взята из открытого текста (plain text);  
c — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
n — количество имеющихся в алфавите букв, мощность алфавита;  
k — ключ, сдвиг (отрицательное число — сдвиг влево; ноль — отсутствие сдвига; положительное число — сдвиг вправо).  

2. Модуль взлома шифра Цезаря методом частотного анализа.  
Суть метода частотного анализа заключается в определении частоты употребления в тексте символов и сравнения их с 
имеющимися в открытом доступе частотных таблиц (для каждого языка своя таблица). При сопоставлении наиболее часто 
встречающихся букв в зашифрованном тексте с частотной таблицей делается рассчет о значении ключа (сдвига) при 
зашифровании текста шифром Цезаря.  
Данный метод плохо работает на коротких текстах.


3. Модуль работы с шифром Виженера.  
Шифр Виженера состоит из последовательности нескольких шифров Цезаря с различными значениями сдвига. Для 
зашифровывания может использоваться таблица алфавитов, называемая tabula recta или квадрат (таблица) Виженера. 
Применительно к латинскому алфавиту таблица Виженера составляется из строк по 26 символов, причём каждая 
следующая строка сдвигается на несколько позиций. Таким образом, в таблице получается 26 различных шифров Цезаря. 
На каждом этапе шифрования используются различные алфавиты, выбираемые в зависимости от символа ключевого слова.

Математически шифр Виженера описывается как:  
c_i = ( m_i + k_i ) mod n, где  
n — количество букв в алфавите,  
c_i — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
m_i — номер буквы открытого текста,  
k_i — номер буквы ключа в алфавите,  
i - номер символа в зашифровываемом тексте.  

4. Модуль работы с шифром Вернама.  
Для применения шифра Вернам присваиваем номер каждому символу обычного текста, например (a = 0, b = 1, c = 2, ... z = 25). 
Ключ для шифрования обычного текста берется длиной, равной длине открытого текста. В процессе шифрования производим 
побитовое XOR для обоих чисел (соответствующего номера символа открытого текста и номера ключевого символа). После 
этого берется результат по модулю, равном размеру алфавита.

Математически шифр Вернама выглядит так:  
c_i = ( m_i XOR k_i ) mod n, где  
n — количество букв в алфавите,  
c_i — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
m_i — номер буквы открытого текста,  
k_i — номер буквы ключа в алфавите,  
i - номер символа в открытом тексте.  

5. Модуль работы со стеганографией.  

5.1. Стеганография BMP-изображений методом LSB.  
Суть метода LSB (Least Significant Bit, наименее значащий бит) заключается в том, что человек в большинстве случаев 
не способен заметить изменений в последнем бите цветовых компонент изображения. Фактически, LSB – это шум, поэтому 
его можно использовать для встраивания информации путем замены менее значащих битов пикселей изображения битами 
секретного сообщения. Метод работает с растровыми изображениями, представленными в формате без компрессии (например,
BMP). Основной недостаток метода – высокая чувствительность к малейшим искажениям контейнера.

5.2. Стеганография JPG-изображений методом DCT LSB.  
Основное отличие от метода LSB (описан в п. 5.1) заключается в том, что данные записываются не в цветовые компоненты, 
а в коэффициенты дискретного косинус-преобразования.

5.3. Стеганография PNG-изображений методом LSB.  
Шифрование производится методом LSB аналогично BMP.

Архитектура проекта:  

1. Модуль Abstract работы с шифрами (абстрактный):  

class AbstractCrypto:  
def encoding - зашифровать.  
def decoding - расшифровать.  
def get_new_text - вернуть текст после обработки.  
def get_new_char - вернуть букву после обработки.  
def check_key - проверка соответствие длины и выбранного алфавита полученному сообщению.  

class AbstractImages:  
def encoding - зашифровать.  
def decoding - расшифровать.  
def get_decode_filename - имя файла с расшифрованным сообщением.  

2. Модуль Crypto работы с шифрами для текстов (классы наследуются от AbstractCrypto):  

class Caesar:  
перегрузка get_new_char в соответствии с кодом.  

class Vijener:  
перегрузка get_new_char в соответствии с кодом.  

class Vernam:  
перегрузка get_new_char в соответствии с кодом.  

3. Модуль Steganography работы со стеганографией над картинками (классы наследуются от AbstractImages):  

class BMPChange(AbstractImages):  
перегрузка encoding и drcoding в соответствии с кодом.  

class JPGChange(AbstractImages):  
перегрузка encoding и drcoding в соответствии с кодом.  

class PNGChange(AbstractImages):  
перегрузка encoding и drcoding в соответствии с кодом.  

4. Модуль Hacking для взлома шифра Цезаря:  

class CaesarHack:  
def caesar_hacker - взлом шифра Цезаря.  
def get_frequency - вычисление частот букв.  
def calc_best_shift - вычисление наименьшой разницы между частотами букв в тексте и в исходных данных.  
def set_language_index - определения языка, на котором написано сообщение.  

5. Модуль Tools: вспомогательные методы, не привязанные к классам и использующиеся в различных частях программы.  

def load_image_file - окно выбора файла с изображением.  
def load_message_file - окно выбора файла с сообщением.  
def write_message_to_file - запись сообщения в файл.  
def key_generate - генерация нового ключа.  
def get_key_filename - окно выбора файла с ключом.  

6. Модуль MyTelebot, обеспечивающий работу Телеграмм-бота:  

def start - обработка сообщения "/start" (начало работы бота).  
def help_message - обработка сообщения "/help" (вызов помощи).    
def callback_data - обработка нажатия на кнопку в чате.  
def text - обработка нажатия кнопки под полем ввода сообщения пользователем.  
def run_telebot - запуск программы бота.  

Используемые библиотеки:  

Stegano - для стеганографии изображений (http://github.com/cedricbonhomme/Stegano)  
Steganocryptopy - для стеганографии png-изображений с использованием ключа (https://github.com/kvvignesh/steganocryptopy)  
Cryptography - для обработки ошибки в ходе расшифрования PNG-изображений  
Zlib - для обработки ошибки в ходе расшифрования JPG-изображений  
Os - для работы с файлами (чтение/запись/проверка существования файла)  
telebot - для работы Телеграмм-бота.  
