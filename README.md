# Телеграмм-бот (криптография и стеганография)

[![cov](https://Alex286756.github.io/CryptoTeleBot/badges/coverage.svg)](https://github.com/Alex286756/CryptoTeleBot/actions)

Функционал проекта:  
Телеграмм-бот является логичным продолжением и развитием desktop-приложения "Шифрование".  
В ходе общения с ботом и ответа на несколько вопросов пользователь получит зашифрованное сообщение, которое может 
направить любым доступным способом своим друзьям, или наоборот, полученное от друзей сообщение расшифровать с 
помощью данного бота.  

Бот может работать со следующими алгоритмами шифрования:  
- Шифр Цезаря (как шифрования/расшифрования так и взлом);  
- Шифр Виженера;  
- Шифр Вернама;  
- стеганография BMP-, JPG- и PNG-изображений.  

1. Модуль работы с шифром Цезаря.  
Шифр Цезаря - шифр, при использовании которого каждая буква из открытого текста заменяется на такую букву, которая в 
алфавите находится на некотором постоянном числе позиций левее или правее от рассматриваемой буквы.

Шифр Цезаря легко взламывается, от чего почти не применяется на практике, но тем не менее известен как один из самых 
простых методов шифрования.

Математически шифр Цезаря описывается как:  
с = (p + k) mod n, где:  
p — номер (буквы нумеруются с 0) в алфавите той буквы, которая была взята из открытого текста (plain text);  
c — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
n — количество имеющихся в алфавите букв, мощность алфавита;  
k — ключ, сдвиг (отрицательное число — сдвиг влево; ноль — отсутствие сдвига; положительное число — сдвиг вправо).  

2. Модуль взлома шифра Цезаря методом частотного анализа.  
Суть метода частотного анализа заключается в определении частоты употребления в тексте символов и сравнения их с 
имеющимися в открытом доступе частотных таблиц (для каждого языка своя таблица). При сопоставлении наиболее часто 
встречающихся букв в зашифрованном тексте с частотной таблицей делается рассчет о значении ключа (сдвига) при 
зашифровании текста шифром Цезаря.  
Данный метод плохо работает на коротких текстах.


3. Модуль работы с шифром Виженера.  
Шифр Виженера состоит из последовательности нескольких шифров Цезаря с различными значениями сдвига. Для 
зашифровывания может использоваться таблица алфавитов, называемая tabula recta или квадрат (таблица) Виженера. 
Применительно к латинскому алфавиту таблица Виженера составляется из строк по 26 символов, причём каждая 
следующая строка сдвигается на несколько позиций. Таким образом, в таблице получается 26 различных шифров Цезаря. 
На каждом этапе шифрования используются различные алфавиты, выбираемые в зависимости от символа ключевого слова.

Математически шифр Виженера описывается как:  
c_i = ( m_i + k_i ) mod n, где  
n — количество букв в алфавите,  
c_i — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
m_i — номер буквы открытого текста,  
k_i — номер буквы ключа в алфавите,  
i - номер символа в зашифровываемом тексте.  

4. Модуль работы с шифром Вернама.  
Для применения шифра Вернам присваиваем номер каждому символу обычного текста, например (a = 0, b = 1, c = 2, ... z = 25). 
Ключ для шифрования обычного текста берется длиной, равной длине открытого текста. В процессе шифрования производим 
побитовое XOR для обоих чисел (соответствующего номера символа открытого текста и номера ключевого символа). После 
этого берется результат по модулю, равном размеру алфавита.

Математически шифр Вернама выглядит так:  
c_i = ( m_i XOR k_i ) mod n, где  
n — количество букв в алфавите,  
c_i — номер (буквы нумеруются с 0) в алфавите той буквы, которая получается в результате зашифрования;  
m_i — номер буквы открытого текста,  
k_i — номер буквы ключа в алфавите,  
i - номер символа в открытом тексте.  

5. Модуль работы со стеганографией.  

5.1. Стеганография BMP-изображений методом LSB.  
Суть метода LSB (Least Significant Bit, наименее значащий бит) заключается в том, что человек в большинстве случаев 
не способен заметить изменений в последнем бите цветовых компонент изображения. Фактически, LSB – это шум, поэтому 
его можно использовать для встраивания информации путем замены менее значащих битов пикселей изображения битами 
секретного сообщения. Метод работает с растровыми изображениями, представленными в формате без компрессии (например,
BMP). Основной недостаток метода – высокая чувствительность к малейшим искажениям контейнера.

5.2. Стеганография JPG-изображений методом DCT LSB.  
Основное отличие от метода LSB (описан в п. 5.1) заключается в том, что данные записываются не в цветовые компоненты, 
а в коэффициенты дискретного косинус-преобразования.

5.3. Стеганография PNG-изображений методом LSB.  
Шифрование производится методом LSB аналогично BMP.

Архитектура проекта:  

1. Модуль Abstract работы с шифрами (абстрактный):  

class AbstractCrypto:  
def encoding - зашифровать.  
def decoding - расшифровать.  
def get_new_text - вернуть текст после обработки.  
def get_new_char - вернуть букву после обработки.  
def check_key - после определения алфавита, на котором написано сообщение, убирается другой алфавит.  

class AbstractImages:  
def encoding - зашифровать.  
def decoding - расшифровать.  
def get_decode_filename - имя файла с расшифрованным сообщением.  

2. Модуль Crypto работы с шифрами для текстов (классы наследуются от AbstractCrypto):  

class Caesar:  
перегрузка get_new_char в соответствии с кодом.  

class Vijener:  
перегрузка get_new_char в соответствии с кодом.  

class Vernam:  
перегрузка get_new_char в соответствии с кодом.  

3. Модуль Steganography работы со стеганографией над картинками (классы наследуются от AbstractImages):  

class BMPChange(AbstractImages):  
перегрузка encoding и decoding в соответствии с кодом.  

class JPGChange(AbstractImages):  
перегрузка encoding и decoding в соответствии с кодом.  

class PNGChange(AbstractImages):  
перегрузка encoding и decoding в соответствии с кодом.  

4. Модуль Hacking для взлома шифра Цезаря:  

class CaesarHack:  
def caesar_hacker - взлом шифра Цезаря.  
def get_frequency - вычисление частот букв.  
def calc_best_shift - вычисление наименьшой разницы между частотами букв в тексте и в исходных данных.  
def set_language_index - определения языка, на котором написано сообщение.  

5. Модуль Tools: вспомогательные методы, не привязанные к классам и использующиеся в различных частях программы.  

def get_new_filename - генерирует имя файла с соответствующим расширением.  
def write_bytes_to_file - записывает набор байтов в файл и возвращает имя файла.  
def write_message_to_file - запись текстового сообщения в файл и возвращает имя файла.  
def key_generate - генерация нового ключа.  

6. Модуль MyTelebot, обеспечивающий работу Телеграмм-бота:  

def start_message - обработка сообщения "/start" (начало работы бота).  
def help_message - обработка сообщения "/help" (вызов помощи).   
def sources_menu - выводит в чат меню выбора исходных данных.  
def set_target_to_encode - обработка нажатия на кнопку "Зашифровать".  
def set_target_to_decode - обработка нажатия на кнопку "Расшифровать".  
def set_source_to_text - обработка нажатия на кнопку "Текст".  
def get_key_for_textcode - получение ключа для обработки текста с клавиатуры.  
def get_file_with_key_for_textcode - получение файла с ключом для обработки текста.  
def get_file_for_textcode - получение файла с текстом сообщения для обработки.  
def get_text_for_textcode - получения текста сообщения с клавиатуры.  
def set_code_to_caesar - обработка нажатия на кнопку "Шифр Цезаря".  
def set_code_to_vijener - обработка нажатия на кнопку "Шифр Виженера".  
def set_code_to_vernam - обработка нажатия на кнопку "Шифр Вернама".  
def steganography_start - вывод в чат сообщения о готовности бота к приему файла изображения.  
def set_source_to_bmp - обработка нажатия на кнопку "bmp-изображение".  
def text_for_encoding_bmp - получение текста для зашифрования в bmp-изображение.  
def file_with_text_for_encoding_bmp - получение файла с текстом для зашифрования в bmp-изображение.  
def get_bmp_image - получение файла с bmp-изображением для применения стеганографии.  
def set_source_to_jpg - обработка нажатия на кнопку "jpg-изображение".  
def text_for_encoding_jpg - получение текста для зашифрования в jpg-изображение.  
def file_with_text_for_encoding_jpg - получение файла с текстом для зашифрования в jpg-изображение.  
def get_jpg_image - получение файла с jpg-изображением для применения стеганографии.  
def set_source_to_png - обработка нажатия на кнопку "png-изображение".  
def get_key_menu - приглашенение к вводу ключа для обработки png-изображения.  
def use_default_key_for_png - обработка нажатия на кнопку "Использовать ключ по умолчанию".  
def generate_new_key_for_png - обработка нажатия на кнопку "Сгенерировать новый ключ".  
def get_key_for_png - получение ключа для обработки png-изображения с клавиатуры.  
def get_file_with_key_for_png - получение файла с ключом для обработки png-изображения.  
def text_for_encoding_png - получение текста для зашифрования в png-изображение.  
def file_with_text_for_encoding_png - олучение файла с текстом для зашифрования в png-изображение.  
def get_png_image - получение файла с png-изображением для применения стеганографии.  
def set_target_to_hacking - обработка нажатия на кнопку "Взломать шифр Цезаря".  
def get_file_for_hacking - получение файла с текстом для взлома шифра Цезаря.  
def get_text_for_hacking - получение текста для взлома шифра Цезаря с клавиатуры.  
def get_other_document - обработка получения файла, неподпадающего под фильтры бота.  
def get_photo - обработка получения сжатого фото вместо изображения, пригодного для обработки.  
def get_text - обработка получения текста с клавиатуры, которые не смог обработать бот.  
def run_telebot - запуск программы бота.

class Constants - определяет набор констант, использующихся в работе бота.

Используемые библиотеки:  

Stegano - для стеганографии изображений (http://github.com/cedricbonhomme/Stegano)  
Steganocryptopy - для стеганографии png-изображений с использованием ключа (https://github.com/kvvignesh/steganocryptopy)  
Cryptography - для обработки ошибки в ходе расшифрования PNG-изображений  
Zlib - для обработки ошибки в ходе расшифрования JPG-изображений  
Os - для работы с файлами (чтение/запись/проверка существования файла)  
telebot - для работы Телеграмм-бота.  


&copy; Куксов Алексей Геннадьевич, 2024 